import"https://cdn.jsdelivr.net/npm/marked/marked.min.js";import"./AdminLayout.astro_astro_type_script_index_1_lang.CpY0iB58.js";import"https://cdn.tailwindcss.com";const f=document.getElementById("content"),d=document.getElementById("preview-content"),y=document.getElementById("preview-toggle"),r=document.getElementById("preview-text");document.getElementById("editor-pane");const g=document.getElementById("preview-pane");let i=!1;y?.addEventListener("click",()=>{i=!i,i?(g?.classList.remove("hidden"),r&&(r.textContent="隐藏预览"),v()):(g?.classList.add("hidden"),r&&(r.textContent="显示预览"))});function v(){if(i&&d){const e=f.value;e.trim()?d.innerHTML=window.marked.parse(e):d.innerHTML='<p class="text-gray-500 italic">预览内容将在这里显示...</p>'}}f.addEventListener("input",v);const m=document.getElementById("title"),p=document.getElementById("slug");m.addEventListener("input",()=>{if(!p.value){const e=m.value.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"");p.value=e}});async function w(){try{const n=await(await fetch("/api/blog?action=categories")).json(),t=document.getElementById("category");n.success&&n.categories&&n.categories.forEach(a=>{const s=document.createElement("option");s.value=a.name,s.textContent=a.name,t.appendChild(s)})}catch(e){console.error("加载分类失败:",e)}}async function c(e=!1){const n=document.getElementById("post-form"),t=new FormData(n),a=t.get("tags")||"",s={title:t.get("title"),slug:t.get("slug"),content:t.get("content"),des:t.get("description"),category:t.get("category"),tags:a.split(",").map(o=>o.trim()).filter(o=>o),cover:t.get("cover")||"",external_url:t.get("external_url")||"",status:e?"draft":"published"};try{const u=await(await fetch("/api/blog",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",data:{...s,date:new Date().toISOString()}})})).json();u.success?(l(e?"草稿保存成功！":"文章发布成功！","success"),setTimeout(()=>{window.location.href="/admin/posts"},1500)):l(u.message||"保存失败","error")}catch(o){console.error("保存失败:",o),l("网络错误，请重试","error")}}function l(e,n="info"){const t=document.createElement("div");t.className=`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${n==="success"?"bg-green-600 text-white":n==="error"?"bg-red-600 text-white":"bg-blue-600 text-white"}`,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}document.getElementById("save-draft-btn").addEventListener("click",e=>{e.preventDefault(),c(!0)});document.getElementById("publish-btn").addEventListener("click",e=>{e.preventDefault(),c(!1)});document.addEventListener("DOMContentLoaded",()=>{w()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),c(!0)),(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),c(!1))});
