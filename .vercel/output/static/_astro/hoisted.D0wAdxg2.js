import"./Header.astro_astro_type_script_index_0_lang.DgzvyZl5.js";import"https://cdn.tailwindcss.com";async function u(){try{const r=await(await fetch("/api/blog?action=categories")).json(),n=document.getElementById("category");r.success&&r.categories&&r.categories.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.textContent=e.name,n.appendChild(a)})}catch(t){console.error("加载分类失败:",t)}}async function m(t){t.preventDefault();const r=document.getElementById("submit-form"),n=document.getElementById("submit-btn"),e=new FormData(r);n.disabled=!0,n.textContent="提交中...";const a=e.get("tags")||"",l={title:e.get("title"),external_url:e.get("external_url"),des:e.get("description"),category:e.get("category"),tags:a.split(",").map(o=>o.trim()).filter(o=>o),cover:e.get("cover")||"",content:`# ${e.get("title")}

${e.get("description")}

[访问资源](${e.get("external_url")})`,slug:d(e.get("title")),submitter_name:e.get("submitter_name"),submitter_email:e.get("submitter_email")};try{const o=await fetch("/api/blog",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",data:{...l,date:new Date().toISOString()}})}),i=await o.json();o.ok&&(i.id||i.message)?(s("提交成功！我们会在3个工作日内审核您的申请。","success"),r.reset(),setTimeout(()=>{window.location.href="/"},2e3)):s(i.error||"提交失败，请重试","error")}catch(o){console.error("提交失败:",o),s("网络错误，请检查网络连接后重试","error")}finally{n.disabled=!1,n.textContent="提交申请"}}function d(t){return t.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")+"-"+Date.now()}function s(t,r="info"){const n=document.createElement("div");n.className=`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform ${r==="success"?"bg-green-600 text-white":r==="error"?"bg-red-600 text-white":"bg-blue-600 text-white"}`,n.style.transform="translateX(100%)",n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.remove()},300)},3e3)}function g(){const t=document.getElementById("title").value.trim(),r=document.getElementById("external_url").value.trim(),n=document.getElementById("category").value,e=document.getElementById("description").value.trim();if(!t||!r||!n||!e)return s("请填写所有必填字段","error"),!1;try{new URL(r)}catch{return s("请输入有效的URL地址","error"),!1}return!0}document.getElementById("submit-form")?.addEventListener("submit",t=>{g()?m(t):t.preventDefault()});document.addEventListener("DOMContentLoaded",()=>{u()});const c=document.getElementById("external_url");c?.addEventListener("blur",()=>{const t=c.value.trim();t&&!t.startsWith("http://")&&!t.startsWith("https://")&&(c.value="https://"+t)});
