---
// 禁用预渲染，确保管理页面可以访问cookies和动态数据
export const prerender = false

import AdminLayout from '../../layouts/AdminLayout.astro'

// 检查用户是否已登录
const cookies = Astro.cookies
const isAuthenticated = cookies.get('admin_auth')?.value === 'authenticated'

// 如果未登录，重定向到登录页面
if (!isAuthenticated) {
  return Astro.redirect('/login')
}
---

<AdminLayout title="系统设置" activeSection="settings">
  <div class="space-y-6">
    <!-- 页面标题 -->
    <div>
      <h1 class="text-2xl font-bold text-gray-900">系统设置</h1>
      <p class="text-gray-600 mt-1">配置系统参数和偏好设置</p>
    </div>

    <!-- 基本设置 -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-semibold text-gray-900">基本设置</h2>
        <p class="text-sm text-gray-500 mt-1">配置站点的基本信息</p>
      </div>
      
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">站点名称</label>
            <input 
              type="text" 
              value="AffDirs"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              placeholder="请输入站点名称"
            />
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">站点标语</label>
            <input 
              type="text" 
              value="精选资源导航平台"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              placeholder="请输入站点标语"
            />
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold text-gray-900 mb-2">站点描述</label>
            <textarea 
              rows="3"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"
              placeholder="请输入站点描述"
            >AffDirs 是一个精选资源导航平台，帮助用户发现和收藏优质的网络资源。</textarea>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">站点关键词</label>
            <input 
              type="text" 
              value="导航, 资源, 工具, 网站"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              placeholder="用逗号分隔多个关键词"
            />
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">联系邮箱</label>
            <input 
              type="email" 
              value="admin@AffDirs.com"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              placeholder="请输入联系邮箱"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- 显示设置 -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-semibold text-gray-900">显示设置</h2>
        <p class="text-sm text-gray-500 mt-1">配置页面显示选项</p>
      </div>
      
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">每页显示文章数</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              <option value="10">10 篇</option>
              <option value="20" selected>20 篇</option>
              <option value="30">30 篇</option>
              <option value="50">50 篇</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">日期格式</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              <option value="YYYY-MM-DD" selected>2024-01-01</option>
              <option value="YYYY/MM/DD">2024/01/01</option>
              <option value="MM/DD/YYYY">01/01/2024</option>
              <option value="DD-MM-YYYY">01-01-2024</option>
            </select>
          </div>
        </div>

        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">显示文章封面</h3>
              <p class="text-sm text-gray-500">在文章列表中显示封面图片</p>
            </div>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
            </button>
          </div>
          
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">显示文章摘要</h3>
              <p class="text-sm text-gray-500">在文章列表中显示文章摘要</p>
            </div>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
            </button>
          </div>
          
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">显示标签云</h3>
              <p class="text-sm text-gray-500">在侧边栏显示标签云</p>
            </div>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 安全设置 -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-semibold text-gray-900">安全设置</h2>
        <p class="text-sm text-gray-500 mt-1">配置系统安全选项</p>
      </div>
      
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">会话超时时间（小时）</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              <option value="1">1 小时</option>
              <option value="6">6 小时</option>
              <option value="12">12 小时</option>
              <option value="24" selected>24 小时</option>
              <option value="168">7 天</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">密码复杂度</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              <option value="simple">简单（6位以上）</option>
              <option value="medium" selected>中等（8位，包含字母数字）</option>
              <option value="strong">强（10位，包含特殊字符）</option>
            </select>
          </div>
        </div>

        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">启用两步验证</h3>
              <p class="text-sm text-gray-500">增强账户安全性</p>
            </div>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
            </button>
          </div>
          
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">登录日志记录</h3>
              <p class="text-sm text-gray-500">记录管理员登录活动</p>
            </div>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 数据备份 -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-semibold text-gray-900">数据管理</h2>
        <p class="text-sm text-gray-500 mt-1">备份和恢复系统数据</p>
      </div>
      
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <h3 class="text-sm font-semibold text-gray-900">数据备份</h3>
            <p class="text-sm text-gray-500">定期备份数据库和配置文件</p>
            <div class="space-y-3">
              <button class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white text-sm font-semibold rounded-xl hover:from-green-700 hover:to-blue-700 transition-all duration-200">
                立即备份数据
              </button>
              <button class="w-full px-4 py-3 bg-gray-100 text-gray-700 text-sm font-semibold rounded-xl hover:bg-gray-200 transition-all duration-200">
                下载备份文件
              </button>
            </div>
          </div>
          
          <div class="space-y-4">
            <h3 class="text-sm font-semibold text-gray-900">数据恢复</h3>
            <p class="text-sm text-gray-500">从备份文件恢复数据</p>
            <div class="space-y-3">
              <input type="file" accept=".db,.sql" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm">
              <button class="w-full px-4 py-3 bg-orange-600 text-white text-sm font-semibold rounded-xl hover:bg-orange-700 transition-all duration-200">
                恢复数据
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 保存按钮 -->
    <div class="flex justify-end">
      <button class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-semibold rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
        保存设置
      </button>
    </div>
  </div>
</AdminLayout>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // 切换开关事件
  const toggles = document.querySelectorAll('button[class*="inline-flex h-6 w-11"]')
  
  toggles.forEach(toggle => {
    toggle.addEventListener('click', () => {
      const isActive = toggle.classList.contains('bg-blue-600')
      const span = toggle.querySelector('span')
      
      if (isActive) {
        toggle.classList.remove('bg-blue-600')
        toggle.classList.add('bg-gray-200')
        span?.classList.remove('translate-x-6')
        span?.classList.add('translate-x-1')
      } else {
        toggle.classList.remove('bg-gray-200')
        toggle.classList.add('bg-blue-600')
        span?.classList.remove('translate-x-1')
        span?.classList.add('translate-x-6')
      }
    })
  })

  // 保存设置
  const saveButton = document.querySelector('button[class*="bg-gradient-to-r from-blue-600"]')
  saveButton?.addEventListener('click', () => {
    alert('设置保存成功！\n\n注意：这是演示功能，实际项目中需要连接后端API保存配置。')
  })

  // 备份数据
  const backupButton = document.querySelector('button[class*="from-green-600"]')
  backupButton?.addEventListener('click', () => {
    alert('数据备份功能\n\n这个功能将导出数据库文件，请在实际项目中实现具体的备份逻辑。')
  })

  // 恢复数据
  const restoreButton = document.querySelector('button[class*="bg-orange-600"]')
  restoreButton?.addEventListener('click', () => {
    if (confirm('确定要恢复数据吗？\n\n这将覆盖当前所有数据，请确保您已经备份了当前数据。')) {
      alert('数据恢复功能\n\n请在实际项目中实现具体的恢复逻辑。')
    }
  })
})
</script>